---
bibliography: references.bib
biblio-style: apalike
highlight_bw: yes
output:
  bookdown::pdf_document2:
    toc: false
    includes:
      in_header: header.tex
    dev: "cairo_pdf"
    latex_engine: xelatex
    fig_caption: yes
geometry: margin=0.6in
link-citations: yes
---

**Supplemental File2 of**

# ggtreeExtra: A universal package to visualize compact circular layers of phylogenetic tree

**Shuangbin Xu, Zehan Dai, Pingfan Guo, Xiaocong Fu, Shanshan Liu, Lang Zhou, Wenli Tang, Tingze Feng, Meijun Chen, Li Zhan and Guangchuang Yu\* **

^\*^correspondence: guangchuangyu@gmail.com, gcyu1@smu.edu.cn

\renewcommand{\figurename}{SFig.}
\newcommand{\beginsupplement}{%
\setcounter{table}{0}
\renewcommand{\thetable}{S\arabic{table}}%
\setcounter{figure}{0}
\renewcommand{\thefigure}{S\arabic{figure}}%
}

\beginsupplement

```{r, echo=FALSE, message=FALSE, results='hide'}
require(kableExtra)
options(knitr.table.fromat = "latex")
knitr::opts_chunk$set(fig.pos= "!ht")
#knitr::opts_chunk$set(out.width="90%")
knitr::opts_chunk$set(fig.align="center")
usepackage_latex("float")
usepackage_latex("makecell")
usepackage_latex("booktabs")
```

## Examples to show how to use *ggtreeExtra* with some geometric function defined by ggplot2-based packages

The supplementary file1 has listed several examples to show how to map the associated data to circular phylogenetic tree using *ggtreeExtra*. These examples has contained the illustration how to use *ggtreeExtra* with common geometric function defined by *ggplot2*[@ggplot2]. Here, we show several cases that *ggtreeExtra* works with geometric function defined by ggplot2-based packages.

### Working with *ggdist* package

*ggdist*[@ggdist] can be used to display the distribution and uncertainty of data, *ggtreeExtra* can work with several geometric function defined by it (supplementary file Table.S1). If the associated data should be displayed the distribution, such as the gene expression in different samples.

(ref:ggdist) This example to show ggtreeExtra works with *geom_dots* and *geom_slabinterval* of *ggdist*[@ggdist]. And ggtreeExtra also support other layout of ggtree [@ggtree1].

```{r, fig.width=7, fig.height=4.5, error=TRUE, warning=FALSE, message=FALSE, fig.cap='(ref:ggdist)', dev="CairoPNG", dpi=300, ggdist}
library(tibble)
library(tidyr)
library(ggdist)
library(ggtree)
library(ggplot2)
library(ggtreeExtra)
library(patchwork)
set.seed(1024)
df = tribble(
    ~id, ~class, ~value,
    "t1",  "phy1", rnorm(100, mean = 5),
    "t2",  "phy2", rnorm(100, mean = 7, sd = 1.5),
    "t3",  "phy3", rnorm(100, mean = 8),
    "t4",  "phy4", rnorm(100, mean = 9),
    "t5",  "phy5", rnorm(100, mean = 7),
    "t6",  "phy1", rnorm(100, mean = 4),
    "t7",  "phy2", rnorm(100, mean = 10),
    "t8",  "phy3", rnorm(100, mean = 12),
    "t9",  "phy4", rnorm(100, mean = 6),
    "t10", "phy5", rnorm(100, mean = 5)
  ) %>% unnest(value)
tr <- rtree(10)
p1 <- ggtree(tr, layout="roundrect", size=0.3) + geom_tiplab(size=3)
p2 <- ggtree(tr, layout="ellipse", size=0.3) + geom_tiplab(size=3)
# The associate data (df) 
p1 <- p1 +
      geom_fruit(data=df,
                 geom=geom_dots,
                 mapping=aes(y=id, x=value, fill=class),
                 position=position_identityx(),
                 color=NA,
                 dotsize=3,
                 pwidth=1.8,
                 offset=0.1,
                 orientation="y",
                 side="both",
                 grid.params=list(),
                 axis.params=list(axis="x",text.size=2, nbreak=6)
      ) + theme(legend.key.size=unit(0.5, "cm"))
p2 <- p2 + 
      geom_fruit(data=df,
                 geom=geom_slabinterval,
                 mapping=aes(y=id, x=value, fill=class),
                 position=position_identityx(),
                 pwidth=1.8,
                 offset=0.1,
                 orientation="y",
                 side="right",
                 stat=StatSampleSlabinterval,
                 grid.params=list(),
                 axis.params=list(axis="x",text.size=2, nbreak=6)
      ) +
      theme(legend.key.size=unit(0.5, "cm"))

p1 / p2
```

### Working with *ggpattern* package

*ggpattern*[@ggpattern] provides geometric layers which support filled areas with geometric and image-based patterns. Some geometric layers of it can also work with *ggtreeExtra*.

(ref:ggpattern) This example to show ggtreeExtra works with *geom_bar_pattern* and *geom_boxplot_pattern* of *ggpattern*[@ggpattern].

```{r, fig.width=8, fig.height=7, error=TRUE, warning=FALSE, message=FALSE, fig.cap='(ref:ggpattern)', dev="CairoPNG", dpi=300, GeomLayers2}
library(ggtree)
library(ggtreeExtra)
library(ggpattern)
library(ggplot2)

set.seed(1024)

tr <- rtree(20)
dat <- data.frame(id=tr$tip.label,
                  value=abs(rnorm(20, 3)),
                  group=c(rep("A", 5), rep("B", 5), rep("C", 5), rep("D", 5)))

dt <- data.frame(id=rep(tr$tip.label, 8), value=abs(rnorm(20 * 8, 8, 1.5)),
                 class=rep(rep(c("A","B","C","D"), 5), 8))

p1 <- ggtree(tr)

p2 <- ggtree(tr, layout="slanted")

p3 <- ggtree(tr, layout="ellipse")

p4 <- ggtree(tr, layout="roundrect")

p1 <- p1 +
      geom_fruit(
          data=dat,
          geom=geom_bar_pattern,
          mapping=aes(y=id, x=value, pattern=group, pattern_angle=group),
          width=0.6,
          stat="identity",
          pwidth = 0.6,
          pattern_spacing =0.01,
          pattern_size = 0.1,
          pattern_density = 0.4,
          fill = "grey",
          pattern_fill="grey35",
          position=position_identityx(),
          axis.params=list(axis="x", text.size=1.5, text.angle=-45, hjust=0)
      ) +
      theme(
          #legend.position= c(0.94, 0.8),
          legend.key.size = unit(0.3, 'cm')
      )

p2 <- p2 +
      geom_fruit(
          data=dat,
          geom=geom_bar_pattern,
          mapping=aes(y=id, x=value, pattern=group, pattern_fill=group),
          width=0.6,
          stat="identity",
          pwidth = 0.6,
          pattern_spacing =0.01,
          pattern_size = 0.1,
          pattern_density = 0.4,
          fill = "grey",
          position=position_identityx(),
          axis.params=list(axis="x",text.size=1.5, text.angle=-45, hjust=0)
      ) +
      theme(
          #legend.position= c(0.94, 0.8),
          legend.key.size = unit(0.3, 'cm')
      )

p3 <- p3 + 
      geom_fruit(
          data=dt,
          geom=geom_boxplot_pattern,
          mapping=aes(y=id, x=value, pattern=class, pattern_angle = class),
          size=0.1,
          outlier.size=0.5,
          pwidth=0.5,
          pattern_size = 0.1,
          pattern_density = 0.4,
          pattern_spacing =0.01,
          fill = "grey",
          pattern_fill="grey35",
          position=position_dodgex(),
          grid.params=list(),
          axis.params=list(axis="x", text.size=1.5, text.angle=-45, hjust=0)
      ) +
      theme(
          #legend.position= c(0.94, 0.8),
          legend.key.size = unit(0.5, 'cm')
      )

p4 <- p4 +
      geom_fruit(
          data=dt,
          geom=geom_boxplot_pattern,
          mapping=aes(y=id, x=value, pattern=class, pattern_fill = class),
          size=0.1,
          outlier.size=0.5,
          pwidth = 0.5,
          pattern_size = 0.1,
          pattern_density = 0.4,
          pattern_spacing =0.01,
          fill = "grey",
          position=position_dodgex(),
          grid.params=list(),
          axis.params=list(axis="x", text.size=1.5, text.angle=-45, hjust=0)
      ) +
      theme(
          #legend.position= c(0.94, 0.8),
          legend.key.size = unit(0.5, 'cm')
      )

(p1 + p2)/(p3 + p4)
```

## Reference
